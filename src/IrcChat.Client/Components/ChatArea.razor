@* src/IrcChat.Client/Components/ChatArea.razor *@
@using IrcChat.Shared.Models

<div class="chat-main">
    @if (string.IsNullOrEmpty(CurrentChannel))
    {
        <div class="welcome">
            <h2>Bienvenue @Username!</h2>
            <p>Créez ou rejoignez un salon pour commencer à chatter.</p>
        </div>
    }
    else
    {
        <div class="chat-header">
            <div class="header-left">
                <h2>#@CurrentChannel</h2>
                <span class="status @(IsConnected ? "connected" : "disconnected")">
                    @(IsConnected ? "● Connecté" : "○ Déconnecté")
                </span>
            </div>
            <div class="header-right">
                <UsersListToggleButton IsOpen="@UsersListOpen"
                                       UserCount="@(Users?.Count ?? 0)"
                                       OnToggle="OnUsersListToggle" />
                <ChannelMuteButton ChannelName="@CurrentChannel"
                                   IsMuted="@IsMuted"
                                   CanManage="@CanManage"
                                   OnMuteStatusChanged="OnMuteStatusChanged" />
                <ChannelDeleteButton ChannelName="@CurrentChannel"
                                     CanManage="@CanManage"
                                     OnChannelDeleted="OnChannelDeleted" />
            </div>
        </div>

        <div class="chat-content @(UsersListOpen ? "users-open" : "users-closed")">
            <div class="chat-messages">
                <MessageList Messages="Messages" CurrentUsername="@Username" />

                <MessageInput IsConnected="IsConnected"
                              OnSendMessage="OnMessageSent" />
            </div>

            <div class="chat-users @(UsersListOpen ? "visible" : "hidden")">
                <ChannelUsersList CurrentChannel="@CurrentChannel"
                                  Username="@Username"
                                  Users="@Users"
                                  OnUserClicked="OnUserClicked" />
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public string Username { get; set; } = string.Empty;

    [Parameter]
    public string CurrentChannel { get; set; } = string.Empty;

    [Parameter]
    public bool IsConnected { get; set; }

    [Parameter]
    public List<Message> Messages { get; set; } = new();

    [Parameter]
    public List<User> Users { get; set; } = new();

    [Parameter]
    public bool IsMuted { get; set; }

    [Parameter]
    public bool CanManage { get; set; }

    [Parameter]
    public bool UsersListOpen { get; set; }

    [Parameter]
    public EventCallback<string> OnMessageSent { get; set; }

    [Parameter]
    public EventCallback<string> OnUserClicked { get; set; }

    [Parameter]
    public EventCallback<bool> OnMuteStatusChanged { get; set; }

    [Parameter]
    public EventCallback<string> OnChannelDeleted { get; set; }

    [Parameter]
    public EventCallback<bool> OnUsersListToggle { get; set; }
}
